<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project: CTF Data handling</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d9/d66/refDetectorsCTF.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CTF Data handling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>CTF I/O</h1>
<h2>CTF writer workflow</h2>
<p><code>o2-ctf-writer-workflow</code> can be piped in the end of the processing workflow to create CTF data. By default data of every detector flagged in the GRP as being read-out are expected. The list of detectors storing CTF data can be managed using <code>--onlyDet arg (=none)</code> and <code>--skipDet arg (=none)</code> comma-separated lists. Every detector writing CTF data is expected to send an output with entropy-compressed <code>EncodedBlocks</code> flat object.</p>
<p>Example of usage: </p><div class="fragment"><div class="line">o2-its-reco-workflow --entropy-encoding | o2-ctf-writer-workflow --onlyDet ITS</div>
</div><!-- fragment --><p>For the storage optimization reason one can request multiple CTFs stored in the same output file (as entries of the <code>ctf</code> tree): </p><div class="fragment"><div class="line">o2-ctf-writer --min-file-size &lt;min&gt; --max-file-size &lt;max&gt; ...</div>
</div><!-- fragment --><p>will accumulate CTFs in entries of the same tree/file until its size fits exceeds <code>min</code> and does not exceed <code>max</code> (<code>max</code> check is disabled if <code>max&lt;=min</code>) or EOS received. The <code>--max-file-size</code> limit will be ignored if the very first CTF already exceeds it.</p>
<p>The output directory (by default: <code>cwd</code>) for CTFs can be set via <code>--output-dir</code> option and must exist. Since in on the EPNs we may store the CTFs on the RAM disk of limited capacity, one can indicate the fall-back storage via <code>--output-dir-alt</code> option. The writer will switch to it if (i) <code>szCheck = max(min-file-size*1.1, max-file-size)</code> is positive and (ii) estimated (accounting for eventual other CTFs files written concurrently) available space on the primary storage is below the <code>szCheck</code>. The available space is estimated as: </p><div class="fragment"><div class="line"> {`}</div>
<div class="line">current physically available space</div>
<div class="line">-</div>
<div class="line">number still open CTF files from concurrent writers * szCheck</div>
<div class="line">+</div>
<div class="line">the current size of these files</div>
<div class="line">~~~`</div>
<div class="line"> </div>
<div class="line">Option `--ctf-dict-dir &lt;dir&gt;` can be provided to indicate the (existing) directory for the dictionary IO.</div>
<div class="line"> </div>
<div class="line">## CTF reader workflow</div>
<div class="line"> </div>
<div class="line">`o2-ctf-reader-workflow` should be the 1st workflow in the piped chain of CTF processing.</div>
<div class="line">At the moment accepts as an input a comma-separated list of CTF files produced by the `o2-ctf-writer-workflow`, reads data for all detectors present in it</div>
<div class="line">(the list can be narrowed by `--onlyDet arg (=none)` and `--skipDet arg (=none)` comma-separated lists), decode them using decoder provided</div>
<div class="line">by detector and injects to DPL. In case of multiple entries in the CTF tree, they all will be read in row.</div>
<div class="line"> </div>
<div class="line">Example of usage:</div>
<div class="line">~~~{.sh}</div>
<div class="line">o2-ctf-reader-workflow --onlyDet ITS --ctf-input o2_ctf_0000000000.root  | o2-its-reco-workflow --trackerCA --clusters-from-upstream --disable-mc</div>
</div><!-- fragment --><p>With <code>--delay &lt;s&gt;</code> a delay of <code>s</code> seconds will be introduced between injections of consecutive CTFs (if &gt;1). One can loop over the input by providing <code>--loop &lt;N=1&gt;</code> option.</p>
<h2>Support for externally provided encoding dictionaries</h2>
<p>By default encoding with generate for every <a class="el" href="../../d5/d14/structTF.html">TF</a> and store in the CTF the dictionary information necessary to decode the CTF. Since the time needed for the creation of dictionary and encoder/decoder may exceed encoding/decoding time, there is a possibility to create in a separate pass a dictionary stored in the CTF-like object and use it for further encoding/decoding.</p>
<p>To create a dictionary run usual CTF creation chain but with extra option, e.g.: </p><div class="fragment"><div class="line">o2-its-reco-workflow --entropy-encoding | o2-ctf-writer-workflow --output-type dict --onlyDet ITS</div>
</div><!-- fragment --><p>This will create a file <code>ctf_dictionary.root</code> containing dictionary data for all detectors processed by the <code>o2-ctf-writer-workflow</code>. By default the dictionary file is written on the exit from the workflow, in <code>CTFWriterSpec::endOfStream()</code> which is currently not called if the workflow is stopped by <code>ctrl-C</code>. Periodic incremental saving of so-far accumulated dictionary data during processing can be triggered by providing an option <code>--save-dict-after &lt;N&gt;</code>.</p>
<p>Following encoding / decoding will use external dictionaries automatically if this file is found in the working directory (eventually it will be provided via CCDB). Note that if the file is found but dictionary data for some detector participating in the workflow are not found, an error will be printed and for given detector the workflows will use in-ctf dictionaries. The dictionaries must be provided for decoding of CTF data encoded using external dictionaries (otherwise an exception will be thrown).</p>
<p>When decoding CTF containing dictionary data (i.e. encoded w/o external dictionaries), the CTF-specific dictionary will be created/used on the fly, ignoring eventually provided external dictionary data. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d0/d2f/refDetectors.html">Module &#39;Detectors&#39;</a></li>
    <li class="footer">Generated on Fri Sep 10 2021 11:59:39 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
